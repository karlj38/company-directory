function advSearch(e,t=null,a=null,n=null){let o,l,d,i,s;switch(e.preventDefault(),t&&a&&n?(s=!0,o="equal",l=n):(t=$("#searchType").val(),a=$("#where").val(),o=$("#operator").val(),l=$("#condition").val(),d=$("#orderBy").val(),i=$("#sortBy").val()),url="",t){case"department":url="php/getDepartments";break;case"location":url="php/getLocations";break;case"personnel":url="php/getPersonnel"}$.getJSON(url,{column:a,operator:o,condition:l,order:d,sort:i},function(e){if(200==e.status.code){const a=e.data;if(a&&a.length){switch(t){case"department":displayDepartments(a);break;case"location":displayLocations(a);break;case"personnel":displayPersonnel(a)}s?$("#currentView").text($("#currentView").text()+` Within ${n}`):(t=t[0].toUpperCase()+t.substr(1),$("#currentView").text(`Custom ${t} Results`))}else alert("No results found")}$("#advSearch").trigger("reset"),$("#expandedAdvSearch").slideUp()})}function closeMenuBar(){$("#menuBar, #overlay").removeClass("active")}function configAdvSearch(){const e=$("#searchType").val();$.getJSON("php/getColumns",{table:e},function(t){if(200==t.status.code){const a=t.data||null;if(a&&a.length){$("#where").empty().append('<option value="" disabled selected hidden>Where</option>'),$("#orderBy").empty().append('<option value="" disabled selected hidden>Order By</option>');let t="";switch(e){case"department":t="d.";break;case"location":t="l.";break;case"personnel":t="p."}a.forEach(e=>{$("#where").append(`<option value="${t}${e.COLUMN_NAME}">${e.COLUMN_NAME}</option>`),$("#orderBy").append(`<option value="${t}${e.COLUMN_NAME}">${e.COLUMN_NAME}</option>`)})}}}),$("#expandedAdvSearch").slideDown()}function configDeptModal(e){$.getJSON("php/getLocations",function(t){if(200==t.status.code){const a=t.data||null;a&&a.length&&($("#deptLoc").empty(),a.forEach(e=>{$("#deptLoc").append(`<option value="${e.id}">${e.name}</option>`)}),getDepartment(e))}})}function configPModal(e,t=null){e.preventDefault(),$.getJSON("php/getDepartments",function(e){if(200==e.status.code){const a=e.data||null;a&&a.length&&($("#pDept").empty(),a.forEach(e=>{$("#pDept").append(`<option value="${e.id}">${e.name}</option>`)}),getPerson(t||$("#search").val()))}})}function configNewDeptModal(){$.getJSON("php/getLocations",function(e){if(200==e.status.code){const t=e.data||null;t&&t.length&&($("#newDeptLoc").empty().append('<option value="" selected disabled hidden>\n        Select Location\n      </option>'),t.forEach(e=>{$("#newDeptLoc").append(`<option value="${e.id}">${e.name}</option>`)}),$("#newDeptModal").modal("show"))}})}function configNewPModal(){$.getJSON("php/getDepartments",function(e){if(200==e.status.code){const t=e.data||null;t&&t.length&&($("#newPLoc").empty().append('<option value="" selected disabled hidden>\n        Select Department\n      </option>'),t.forEach(e=>{$("#newPDept").append(`<option value="${e.id}">${e.name}</option>`)}),$("#newPModal").modal("show"))}})}function deleteDepartment(e){e.preventDefault();const t=$("#deptID").text(),a=$("#deptName").val(),n=confirm(`Are you sure you wish to delete ${a}?`);n&&$.ajax({url:"php/deleteDepartment",type:"DELETE",data:{id:t},success:function(e){200==e.status.code&&(getDepartments(),$("#deptModal").modal("hide"))}})}function deleteLocation(e){e.preventDefault();const t=$("#locID").text(),a=$("#locName").val(),n=confirm(`Are you sure you wish to delete ${a}?`);n&&$.ajax({url:"php/deleteLocation",type:"DELETE",data:{id:t},success:function(e){200==e.status.code&&(getLocations(),$("#locModal").modal("hide"))}})}function deletePersonnel(e){e.preventDefault();const t=$("#pID").text(),a=$("#pFName").val(),n=$("#pLName").val(),o=confirm(`Are you sure you wish to delete ${a} ${n}?`);o&&$.ajax({url:"php/deletePersonnel",type:"DELETE",data:{id:t},success:function(e){200==e.status.code&&(getPersonnel(),$("#pModal").modal("hide"))}})}function displayDepartments(e){$("#grid").empty(),e.forEach(function(e){let t=$('<div class="col-12 col-sm-6 col-md-4 col-lg-4 col-xl-3 mb-4"></div>'),a=$(`<div id="d${e.id}" class="card mx-auto"></div>`),n=$('<div class="card-header"></div>');n.append(`<h2 class="card-title fs-4">${e.name}</h2>`),a.append(n);let o=$('<div class="card-body"></div>');o.append(`<p class="card-subtitle">${e.location}</p>`),o.append(`<p class="card-text">Personnel: ${e.personnel}</p>`),a.append(o);let l=$('<div class="card-footer text-end"></div>'),d=$('<div class="dropdown d-inline me-2"></div>'),i=$(`<button id="l${e.id}View" class="btn btn-primary btn-sm dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false"><i class="fas fa-eye"></i></button>`);d.append(i);let s=$(`<div class="dropdown-menu" aria-labelled-by="l${e.id}View"></div>`);s.append(`<li><a class="dropdown-item list-group-item list-group-item-action" onclick="advSearch(event, 'location', 'l.name', '${e.location}')">Location</a></li>`),s.append(`<li><a class="dropdown-item list-group-item list-group-item-action" onclick="advSearch(event, 'personnel', 'd.name', '${e.name}')">Personnel</a></li>`),d.append(s),l.append(d),l.append(`<button class="btn btn-secondary btn-sm" onclick="configDeptModal(${e.id})"><i class="fa fa-edit"></i></button>`),a.append(l),t.append(a),$("#grid").append(t)}),$("#currentView").text("All Departments"),closeMenuBar()}function displayLocations(e){$("#grid").empty(),e.forEach(function(e){let t=$('<div class="col-12 col-sm-6 col-md-4 col-lg-4 col-xl-3 mb-4"></div>'),a=$(`<div id="l${e.id}" class="card mx-auto"></div>`),n=$('<div class="card-header"></div>');n.append(`<h2 class="card-title fs-4">${e.name}</h2>`),a.append(n);let o=$('<div class="card-body"></div>');o.append(`<p class="card-text">Departments: ${e.departments}</p>`),o.append(`<p class="card-text">Personnel: ${e.personnel}</p>`),a.append(o);let l=$('<div class="card-footer text-end"></div>'),d=$('<div class="dropdown d-inline me-2"></div>'),i=$(`<button id="l${e.id}View" class="btn btn-primary btn-sm dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false"><i class="fas fa-eye"></i></button>`);d.append(i);let s=$(`<div class="dropdown-menu" aria-labelled-by="l${e.id}View"></div>`);s.append(`<li><a class="dropdown-item list-group-item list-group-item-action" onclick="advSearch(event, 'department', 'l.name', '${e.name}')">Departments</a></li>`),s.append(`<li><a class="dropdown-item list-group-item list-group-item-action" onclick="advSearch(event, 'personnel', 'l.name', '${e.name}')">Personnel</a></li>`),d.append(s),l.append(d),l.append(`<button class="btn btn-secondary btn-sm" onclick="getLocation(${e.id})"><i class="fa fa-edit"></i></button>`),a.append(l),t.append(a),$("#grid").append(t)}),$("#currentView").text("All Locations"),closeMenuBar()}function displayPersonnel(e){$("#grid").empty(),e.forEach(function(e){let t=$('<div class="col-12 col-sm-6 col-md-4 col-lg-4 col-xl-3 mb-4"></div>'),a=$(`<div id="e${e.id}" class="card mx-auto"></div>`),n=$('<div class="card-header"></div>');n.append(`<h2 class="card-title fs-4">${e.firstName} ${e.lastName}</h2>`),a.append(n);let o=$('<div class="card-body"></div>');e.jobTitle&&o.append(`<p class="card-subtitle">${e.jobTitle}</p>`),o.append(`<p class="card-text">${e.department}, ${e.location}</p>`),a.append(o);let l=$('<div class="card-footer text-end"></div>');l.append(`<a href="mailto:${e.email}" target="_blank" class="me-2"><button class="btn btn-primary btn-sm"><i class="fas fa-envelope"></i></button></a>`);let d=$('<div class="dropdown d-inline me-2"></div>'),i=$(`<button id="l${e.id}View" class="btn btn-primary btn-sm dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false"><i class="fas fa-eye"></i></button>`);d.append(i);let s=$(`<div class="dropdown-menu" aria-labelled-by="l${e.id}View"></div>`);s.append(`<li><a class="dropdown-item list-group-item list-group-item-action" onclick="advSearch(event, 'department', 'd.name', '${e.department}')">Department</a></li>`),s.append(`<li><a class="dropdown-item list-group-item list-group-item-action" onclick="advSearch(event, 'location', 'l.name', '${e.location}')">Location</a></li>`),d.append(s),l.append(d),l.append(`<button class="btn btn-secondary btn-sm" onclick="configPModal(event, ${e.id})"><i class="fa fa-user-edit"></i></button>`),a.append(l),t.append(a),$("#grid").append(t)}),$("#currentView").text("All Personnel"),closeMenuBar()}function getDepartment(e){$.getJSON("php/getDepartments",{column:"d.id",operator:"equal",condition:e},function(t,a){if(200==t.status.code)if(t.data&&t.data.length){const a=t.data[0];$("#deptName").val(a.name),$("#deptLoc").val(a.locID),$("#deptID").text(e),0==a.personnel?$("#deleteDept").show():$("#deleteDept").hide(),$("#deptModal").modal("show")}else alert("No result found")})}function getLocation(e){$.getJSON("php/getLocations",{column:"l.id",operator:"equal",condition:e},function(t,a){if(200==t.status.code)if(t.data&&t.data.length){const a=t.data[0];$("#locName").val(a.name),$("#locID").text(e),0==a.departments&&0==a.personnel?$("#deleteLoc").show():$("#deleteLoc").hide(),$("#locModal").modal("show")}else alert("No result found")})}function getPerson(e){$.getJSON("php/getPersonnel",{column:"p.id",operator:"equal",condition:e},function(t,a){if(200==t.status.code)if(t.data&&t.data.length){const a=t.data[0];$("#pFName").val(a.firstName),$("#pLName").val(a.lastName),$("#pJob").val(a.jobTitle),$("#pEmail").val(a.email),$("#pDept").val(a.deptID),$("#pID").text(e),$("#pModal").modal("show")}else alert("No result found")})}function getDepartments(){$.getJSON("php/getDepartments",function(e){const t=e.data||null;200==e.status.code&&(t&&t.length?displayDepartments(t):alert("No results found"))})}function getPersonnel(){$.getJSON("php/getPersonnel",function(e){const t=e.data||null;200==e.status.code&&(t&&t.length?displayPersonnel(t):alert("No results found"))})}function getLocations(){$.getJSON("php/getLocations",function(e){const t=e.data||null;200==e.status.code&&(t&&t.length?displayLocations(t):alert("No results found"))})}function newDepartment(e){e.preventDefault();const t=$("#newDept").val(),a=$("#newDeptLoc").val(),n=confirm(`Are you sure you wish to create ${t}?`);n&&$.post("php/newDepartment",{name:t,locID:a},function(e){201==e.status.code&&(getDepartments(),$("#newDeptAlert").fadeIn().delay(3e3).fadeOut(),$("#newDeptForm").trigger("reset"))})}function newLocation(e){e.preventDefault();const t=$("#newLoc").val(),a=confirm(`Are you sure you wish to create ${t}?`);a&&$.post("php/newLocation",{name:t},function(e){201==e.status.code&&(getLocations(),$("#newLocAlert").fadeIn().delay(3e3).fadeOut(),$("#newLocForm").trigger("reset"))})}function newPersonnel(e){e.preventDefault();const t=$("#newPFName").val(),a=$("#newPLName").val(),n=$("#newPJob").val(),o=$("#newPEmail").val(),l=$("#newPDept").val(),d=confirm(`Are you sure you wish to create ${t} ${a}?`);d&&$.post("php/newPersonnel",{fName:t,lName:a,job:n,email:o,deptID:l},function(e){201==e.status.code&&(getPersonnel(),$("#newPAlert").fadeIn().delay(3e3).fadeOut(),$("#newPForm").trigger("reset"))})}function openMenuBar(){$("#menuBar, #overlay").addClass("active")}function toggleAdvSearch(){$("#toggleAdvSearch i").toggleClass("rotate90"),$("#advSearch").slideToggle("fast")}function toTop(){$("html, body").animate({scrollTop:0},500)}function updateDepartment(e){e.preventDefault();const t=$("#deptID").text(),a=$("#deptName").val(),n=$("#deptLoc").val(),o=confirm(`Are you sure you wish to edit ${a}?`);o&&$.ajax({url:"php/updateDepartment",type:"PUT",data:{id:t,name:a,locID:n},success:function(e){200==e.status.code&&(getDepartments(),$("#updateDAlert").fadeIn().delay(3e3).fadeOut())}})}function updateLocation(e){e.preventDefault();const t=$("#locName").val(),a=$("#locID").text(),n=confirm(`Are you sure you wish to edit ${t}?`);n&&$.ajax({url:"php/updateLocation",type:"PUT",data:{id:a,name:t},success:function(e){200==e.status.code&&(getLocations(),$("#updateLAlert").fadeIn().delay(3e3).fadeOut())}})}function updatePersonnel(e){e.preventDefault();const t=$("#pID").text(),a=$("#pFName").val(),n=$("#pLName").val(),o=$("#pJob").val(),l=$("#pEmail").val(),d=$("#pDept").val(),i=confirm(`Are you sure you wish to edit ${a} ${n}?`);i&&$.ajax({url:"php/updatePersonnel",type:"PUT",data:{id:t,fName:a,lName:n,job:o,email:l,deptID:d},success:function(e){200==e.status.code&&(getPersonnel(),$("#updatePAlert").fadeIn().delay(3e3).fadeOut())}})}$(function(){getLocations(),$("form").trigger("reset"),$(window).scroll(function(){$(this).scrollTop()>screen.availHeight/2?$("#toTop").fadeIn():$("#toTop").fadeOut()}),$("#preloader").fadeOut().remove()});