function advSearch(e,t=null,n=null,a=null){let o,l,d,s,i;switch(e.preventDefault(),t&&n&&a?(i=!0,o="equal",l=a):(t=$("#searchType").val(),n=$("#where").val(),o=$("#operator").val(),l=$("#condition").val(),d=$("#orderBy").val(),s=$("#sortBy").val()),url="",t){case"department":url="php/getDepartments";break;case"location":url="php/getLocations";break;case"personnel":url="php/getPersonnel"}$.getJSON(url,{column:n,operator:o,condition:l,order:d,sort:s},function(e){if(200==e.status.code){const n=e.data;if(n&&n.length){switch(t){case"department":displayDepartments(n);break;case"location":displayLocations(n);break;case"personnel":displayPersonnel(n)}i?$("#currentView").text($("#currentView").text()+` Within ${a}`):(t=t[0].toUpperCase()+t.substr(1),$("#currentView").text(`Custom ${t} Results`))}else alert("No results found")}$("#advSearch").trigger("reset"),$("#expandedAdvSearch").slideUp()})}function closeMenuBar(){$("#menuBar, #overlay").removeClass("active")}function configAdvSearch(){const e=$("#searchType").val();$.getJSON("php/getColumns",{table:e},function(t){if(200==t.status.code){const n=t.data||null;if(n&&n.length){$("#where").empty().append('<option value="" disabled selected hidden>Where</option>'),$("#orderBy").empty().append('<option value="" disabled selected hidden>Order By</option>');let t="";switch(e){case"department":t="d.";break;case"location":t="l.";break;case"personnel":t="p."}n.forEach(e=>{$("#where").append(`<option value="${t}${e.COLUMN_NAME}">${e.COLUMN_NAME}</option>`),$("#orderBy").append(`<option value="${t}${e.COLUMN_NAME}">${e.COLUMN_NAME}</option>`)})}}}),$("#expandedAdvSearch").slideDown()}function configDeptModal(e){$.getJSON("php/getLocations",function(t){if(200==t.status.code){const n=t.data||null;n&&n.length&&($("#deptLoc").empty(),n.forEach(e=>{$("#deptLoc").append(`<option value="${e.id}">${e.name}</option>`)}),getDepartment(e))}})}function configPModal(e,t=null){e.preventDefault(),$.getJSON("php/getDepartments",function(e){if(200==e.status.code){const n=e.data||null;n&&n.length&&($("#pDept").empty(),n.forEach(e=>{$("#pDept").append(`<option value="${e.id}">${e.name}</option>`)}),getPerson(t||$("#search").val()))}})}function configNewDeptModal(){$.getJSON("php/getLocations",function(e){if(200==e.status.code){const t=e.data||null;t&&t.length&&($("#newDeptLoc").empty().append('<option value="" selected disabled hidden>\n        Select Location\n      </option>'),t.forEach(e=>{$("#newDeptLoc").append(`<option value="${e.id}">${e.name}</option>`)}),$("#newDeptModal").modal("show"))}})}function configNewPModal(){$.getJSON("php/getDepartments",function(e){if(200==e.status.code){const t=e.data||null;t&&t.length&&($("#newPLoc").empty().append('<option value="" selected disabled hidden>\n        Select Department\n      </option>'),t.forEach(e=>{$("#newPDept").append(`<option value="${e.id}">${e.name}</option>`)}),$("#newPModal").modal("show"))}})}function checkDeletion(e,t,n){let a,o;switch(e){case"department":a="d.name",o="personnel";break;case"location":a="l.name",o="department"}$.getJSON("php/checkDeletion",{table:e,id:t},function(l){"safe to delete"==l.status.description?configDeleteModal(e,t,n):"cannot delete"==l.status.description&&($("toastErrorMessage").empty(),$("#toastErrorMessage").append(`<p>Cannot delete ${e} with existing ${o}.</p>`),$("#toastErrorMessage").append(`<p><button type="button" class="btn btn-outline-primary" onclick="advSearch(event, '${o}', '${a}', '${n}')" data-bs-dismiss="toast">View dependecies</button></p>`),toastError.show())})}function configDeleteModal(e,t,n){$("#confirmTarget").text(n),$("#confirmDeleteButton").attr("onclick",`deleteEntry('${e}', ${t}, '${n}')`),$("#confirmDeleteModal").modal("show")}function deleteEntry(e,t,n){$.ajax({url:"php/delete",type:"DELETE",data:{table:e,id:t},success:function(t){if(200==t.status.code)switch(e){case"department":getDepartments();break;case"location":getLocations();case"personnel":getPersonnel();default:$("confirmDeleteModal").modal("hide"),$("#toastSuccessMessage").text(`Deleted ${n}`),toastSuccess.show()}}})}function displayDepartments(e){$("#grid").empty(),e.forEach(function(e){let t=$('<div class="col-12 col-sm-6 col-md-4 col-lg-4 col-xl-3 mb-4"></div>'),n=$(`<div id="d${e.id}" class="card mx-auto"></div>`),a=$('<div class="card-header"></div>');a.append(`<h2 class="card-title fs-4">${e.name}</h2>`),n.append(a);let o=$('<div class="card-body"></div>');o.append(`<p class="card-text">${e.location}</p>`),o.append(`<p class="card-text">Personnel: ${e.personnel}</p>`),n.append(o);let l=$('<div class="card-footer text-end"></div>'),d=$('<div class="dropdown d-inline me-2"></div>'),s=$(`<button id="l${e.id}View" class="btn btn-primary btn-sm dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false"><i class="fas fa-eye"></i></button>`);d.append(s);let i=$(`<div class="dropdown-menu p-0" aria-labelled-by="l${e.id}View"></div>`);i.append(`<li><button type="button" class="dropdown-item list-group-item list-group-item-action" onclick="advSearch(event, 'location', 'l.name', '${e.location}')">Location</button></li>`),i.append(`<li><button type="button" class="dropdown-item list-group-item list-group-item-action" onclick="advSearch(event, 'personnel', 'd.name', '${e.name}')">Personnel</button></li>`),d.append(i),l.append(d),l.append(`<button class="btn btn-secondary btn-sm me-2" onclick="configDeptModal(${e.id})"><i class="fa fa-edit"></i></button>`),l.append(`<button type="button" class="btn btn-danger btn-sm" onclick="checkDeletion('department', ${e.id}, '${e.name}')">\n      <i class="fas fa-folder-minus"></i>\n    </button>`),n.append(l),t.append(n),$("#grid").append(t)}),$("#currentView").text("All Departments"),closeMenuBar()}function displayLocations(e){$("#grid").empty(),e.forEach(function(e){let t=$('<div class="col-12 col-sm-6 col-md-4 col-lg-4 col-xl-3 mb-4"></div>'),n=$(`<div id="l${e.id}" class="card mx-auto"></div>`),a=$('<div class="card-header"></div>');a.append(`<h2 class="card-title fs-4">${e.name}</h2>`),n.append(a);let o=$('<div class="card-body"></div>');o.append(`<p class="card-text">Departments: ${e.departments}</p>`),o.append(`<p class="card-text">Personnel: ${e.personnel}</p>`),n.append(o);let l=$('<div class="card-footer text-end"></div>'),d=$('<div class="dropdown d-inline me-2"></div>'),s=$(`<button id="l${e.id}View" class="btn btn-primary btn-sm dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false"><i class="fas fa-eye"></i></button>`);d.append(s);let i=$(`<div class="dropdown-menu p-0" aria-labelled-by="l${e.id}View"></div>`);i.append(`<li><button type="button" class="dropdown-item list-group-item list-group-item-action" onclick="advSearch(event, 'department', 'l.name', '${e.name}')">Departments</button></li>`),i.append(`<li><button type="button" class="dropdown-item list-group-item list-group-item-action" onclick="advSearch(event, 'personnel', 'l.name', '${e.name}')">Personnel</button></li>`),d.append(i),l.append(d),l.append(`<button class="btn btn-secondary btn-sm me-2" onclick="getLocation(${e.id})"><i class="fa fa-edit"></i></button>`),l.append(`<button id="deleteLoc" type="button" class="btn btn-danger btn-sm" onclick="checkDeletion('location', ${e.id}, '${e.name}')">\n      <i class="fas fa-folder-minus"></i>\n    </button>`),n.append(l),t.append(n),$("#grid").append(t)}),$("#currentView").text("All Locations"),closeMenuBar()}function displayPersonnel(e){$("#grid").empty(),e.forEach(function(e){let t=$('<div class="col-12 col-sm-6 col-md-4 col-lg-4 col-xl-3 mb-4"></div>'),n=$(`<div id="e${e.id}" class="card mx-auto"></div>`),a=$('<div class="card-header"></div>');a.append(`<h2 class="card-title fs-4">${e.firstName} ${e.lastName}</h2>`),n.append(a);let o=$('<div class="card-body"></div>');e.jobTitle&&o.append(`<p class="card-subtitle">${e.jobTitle}</p>`),o.append(`<p class="card-text">${e.department}</p>`),o.append(`<p class="card-text">${e.location}</p>`),n.append(o);let l=$('<div class="card-footer text-end"></div>');l.append(`<a href="mailto:${e.email}" target="_blank" class="me-2"><button class="btn btn-primary btn-sm"><i class="fas fa-envelope"></i></button></a>`);let d=$('<div class="dropdown d-inline me-2"></div>'),s=$(`<button id="l${e.id}View" class="btn btn-primary btn-sm dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false"><i class="fas fa-eye"></i></button>`);d.append(s);let i=$(`<div class="dropdown-menu p-0" aria-labelled-by="l${e.id}View"></div>`);i.append(`<li><button type="button" class="dropdown-item list-group-item list-group-item-action" onclick="advSearch(event, 'department', 'd.name', '${e.department}')">Department</button></li>`),i.append(`<li><button type="button" class="dropdown-item list-group-item list-group-item-action" onclick="advSearch(event, 'location', 'l.name', '${e.location}')">Location</button></li>`),d.append(i),l.append(d),l.append(`<button class="btn btn-secondary btn-sm me-2" onclick="configPModal(event, ${e.id})"><i class="fa fa-user-edit"></i></button>`),l.append(`<button type="button" class="btn btn-danger btn-sm" onclick="configDeleteModal('personnel',${e.id}, '${e.firstName} ${e.lastName}')">\n      <i class="fas fa-user-minus"></i>\n    </button>`),n.append(l),t.append(n),$("#grid").append(t)}),$("#currentView").text("All Personnel"),closeMenuBar()}function getDepartment(e){$.getJSON("php/getDepartments",{column:"d.id",operator:"equal",condition:e},function(t,n){if(200==t.status.code)if(t.data&&t.data.length){const n=t.data[0];$("#deptName").val(n.name),$("#deptLoc").val(n.locID),$("#deptID").text(e),0==n.personnel?$("#deleteDept").show():$("#deleteDept").hide(),$("#deptModal").modal("show")}else alert("No result found")})}function getLocation(e){$.getJSON("php/getLocations",{column:"l.id",operator:"equal",condition:e},function(t,n){if(200==t.status.code)if(t.data&&t.data.length){const n=t.data[0];$("#locName").val(n.name),$("#locID").text(e),0==n.departments&&0==n.personnel?$("#deleteLoc").show():$("#deleteLoc").hide(),$("#locModal").modal("show")}else alert("No result found")})}function getPerson(e){$.getJSON("php/getPersonnel",{column:"p.id",operator:"equal",condition:e},function(t,n){if(200==t.status.code)if(t.data&&t.data.length){const n=t.data[0];$("#pFName").val(n.firstName),$("#pLName").val(n.lastName),$("#pJob").val(n.jobTitle),$("#pEmail").val(n.email),$("#pDept").val(n.deptID),$("#pID").text(e),$("#pModal").modal("show")}else alert("No result found")})}function getDepartments(){$.getJSON("php/getDepartments",function(e){const t=e.data||null;200==e.status.code&&(t&&t.length?displayDepartments(t):alert("No results found"))})}function getPersonnel(){$.getJSON("php/getPersonnel",function(e){const t=e.data||null;200==e.status.code&&(t&&t.length?displayPersonnel(t):alert("No results found"))})}function getLocations(){$.getJSON("php/getLocations",function(e){const t=e.data||null;200==e.status.code&&(t&&t.length?displayLocations(t):alert("No results found"))})}function newDepartment(e){e.preventDefault();const t=$("#newDept").val(),n=$("#newDeptLoc").val(),a=confirm(`Are you sure you wish to create ${t}?`);a&&$.post("php/newDepartment",{name:t,locID:n},function(e){201==e.status.code&&(getDepartments(),$("#newDeptAlert").fadeIn().delay(3e3).fadeOut(),$("#newDeptForm").trigger("reset"))})}function newLocation(e){e.preventDefault();const t=$("#newLoc").val(),n=confirm(`Are you sure you wish to create ${t}?`);n&&$.post("php/newLocation",{name:t},function(e){201==e.status.code&&(getLocations(),$("#newLocAlert").fadeIn().delay(3e3).fadeOut(),$("#newLocForm").trigger("reset"))})}function newPersonnel(e){e.preventDefault();const t=$("#newPFName").val(),n=$("#newPLName").val(),a=$("#newPJob").val(),o=$("#newPEmail").val(),l=$("#newPDept").val(),d=confirm(`Are you sure you wish to create ${t} ${n}?`);d&&$.post("php/newPersonnel",{fName:t,lName:n,job:a,email:o,deptID:l},function(e){201==e.status.code&&(getPersonnel(),$("#newPAlert").fadeIn().delay(3e3).fadeOut(),$("#newPForm").trigger("reset"))})}function openMenuBar(){$("#menuBar, #overlay").addClass("active")}function toggleAdvSearch(){$("#toggleAdvSearch i").toggleClass("rotate90"),$("#advSearch").slideToggle("fast")}function toTop(){$("html, body").animate({scrollTop:0},500)}function updateDepartment(e){e.preventDefault();const t=$("#deptID").text(),n=$("#deptName").val(),a=$("#deptLoc").val(),o=confirm(`Are you sure you wish to edit ${n}?`);o&&$.ajax({url:"php/updateDepartment",type:"PUT",data:{id:t,name:n,locID:a},success:function(e){200==e.status.code&&(getDepartments(),$("#updateDAlert").fadeIn().delay(3e3).fadeOut())}})}function updateLocation(e){e.preventDefault();const t=$("#locName").val(),n=$("#locID").text(),a=confirm(`Are you sure you wish to edit ${t}?`);a&&$.ajax({url:"php/updateLocation",type:"PUT",data:{id:n,name:t},success:function(e){200==e.status.code&&(getLocations(),$("#updateLAlert").fadeIn().delay(3e3).fadeOut())}})}function updatePersonnel(e){e.preventDefault();const t=$("#pID").text(),n=$("#pFName").val(),a=$("#pLName").val(),o=$("#pJob").val(),l=$("#pEmail").val(),d=$("#pDept").val(),s=confirm(`Are you sure you wish to edit ${n} ${a}?`);s&&$.ajax({url:"php/updatePersonnel",type:"PUT",data:{id:t,fName:n,lName:a,job:o,email:l,deptID:d},success:function(e){200==e.status.code&&(getPersonnel(),$("#updatePAlert").fadeIn().delay(3e3).fadeOut())}})}$(function(){getPersonnel(),$("form").trigger("reset"),$(window).scroll(function(){$(this).scrollTop()>screen.availHeight/2?$("#toTop").fadeIn():$("#toTop").fadeOut()}),$("#preloader").fadeOut().remove();const e=document.getElementById("toastError");window.toastError=new bootstrap.Toast(e);const t=document.getElementById("toastSuccess");window.toastSuccess=new bootstrap.Toast(t)});